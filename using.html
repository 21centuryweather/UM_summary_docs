

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Using the UM &#8212; Unified Model Summary Documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'using';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Code management and structure" href="code.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="introduction.html">
  
  
  
  
  
  
    <p class="title logo__title">Unified Model Summary Documentation</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="introduction.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="understanding.html">Understanding the UM</a></li>
<li class="toctree-l1"><a class="reference internal" href="code.html">Code management and structure</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Using the UM</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/21centuryweather/UM_summary_docs" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/21centuryweather/UM_summary_docs/issues/new?title=Issue%20on%20page%20%2Fusing.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/using.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Using the UM</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reconfiguration">Reconfiguration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-a-new-limited-area-model-lam">Setting up a new Limited Area Model (LAM)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-a-new-lam-domain">Setting up a new LAM domain</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-new-ancillary-files">Creating new ancillary files</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#obtaining-new-lateral-boundary-data">Obtaining new lateral boundary data</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="using-the-um">
<h1>Using the UM<a class="headerlink" href="#using-the-um" title="Permalink to this heading">#</a></h1>
<p>Let’s through a simple UM tutorial.</p>
<p><a class="reference external" href="https://code.metoffice.gov.uk/doc/um/latest/um-training/getting-started.html">https://code.metoffice.gov.uk/doc/um/latest/um-training/getting-started.html</a></p>
<p>(To do - insert user screenshots)</p>
<ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">bush</span></code> (web viewer) to look at logs, stderr and stdout.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">stem</span></code> is a CI tool for the UM trunk.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rosie</span></code> handles suite storage and discovery, based on SVN and a web-accessed database (MOSRS)</p></li>
</ul>
<section id="reconfiguration">
<h2>Reconfiguration<a class="headerlink" href="#reconfiguration" title="Permalink to this heading">#</a></h2>
<p>As previously mentioned, a lot of the work to configure the UM to run over a new domain, at a new resolution, is performed by the <em>Reconfigure</em> executable.</p>
<p>The reconfiguration is part of the suite of UM supporting executables and is a standalone program. The re- configuration allows the user to modify UM dump files which contain the necessary data to define the initial conditions for a model run. The format of UM dump files is described in <a class="reference external" href="https://code.metoffice.gov.uk/doc/um/latest/papers/umdp_F03.pdf">UMDP-F03</a> . The reconfiguration program only processes atmospheric data.</p>
<p>The reconfiguration is run as a task within a Rose suite. The initial conditions are input in the UM app namelist and configurable through the UM Rose GUI. Not all UM suites require a reconfiguration task and thus this may or may not be included in a suite dependency graph as required.</p>
<ul class="simple">
<li><p>Reconfiguration allows the user to modify UM dump files which contain information to define the initial conditions. A file needs reconfiguring if:</p>
<ul>
<li><p>Upgrade to new model release</p></li>
<li><p>Change of resolution or area</p></li>
<li><p>Configure from an ancillary file to overwrite existing data or form a new field</p></li>
<li><p>New prognostics or tracers</p></li>
<li><p>Starting from a GRIB file</p></li>
</ul>
</li>
<li><p>Reconfigure can also initialise from NetCDF, initialise the VAR LS state dumps.</p></li>
<li><p>Any data from external sources to the model must be at the same resolution and on the same domain as the output dump.</p></li>
<li><p>Reconfiguration can be defined using a GUI</p></li>
<li><p>Reconfiguration is compiled using <code class="docutils literal notranslate"><span class="pre">fcm_make</span></code></p></li>
<li><p>Ancillary files can updated standard fields via reconfiguration.</p></li>
<li><p>You can ‘transplant’ or replace input data.</p></li>
<li><p>It is strongly recommended to use dedicated ancillary files at the new resolution (i.e. don’t rely on the UM to interpolate for you).</p></li>
<li><p>Make sure your orography, land-sea mask and sea-ice are consistent. Don’t request orography or land-sea mask from an ancillary as it will trigger interpolation.</p></li>
<li><p>Reconfiguration as a coastal adjustment step, adjusting land specific fields at coastal points where horizontal interpolation uses a mixture of land and sea points. The spiral coastal adjustment scheme is recommended here.</p></li>
<li><p>Changing vertical resolution must be done with great care!</p>
<ul>
<li><p>Specify <code class="docutils literal notranslate"><span class="pre">ETA_THETA</span></code> and <code class="docutils literal notranslate"><span class="pre">ERA_RHO</span></code> values to ensure smooth variation b/w levels</p></li>
<li><p>Use predefined vertical level sets when available.</p></li>
</ul>
</li>
<li><p>Changing horizontal or vertical levels may require changing dynamics and diffusion parameters. Seek advice from dynamics code experts</p></li>
<li><p>Changing horizontal resolution:</p>
<ul>
<li><p><strong>UM -&gt; namelist -&gt; Reconfiguration and Ancillary control -&gt; Output dump grid sizes and levels</strong>: Specific number of rows and <code class="docutils literal notranslate"><span class="pre">row_length</span></code>. Number of land points is required if you are reconfiguring to a different horizontal resolution without a land sea mask</p></li>
<li><p><strong>UM -&gt; namelist -&gt; Top Level Model control -&gt; Model domain and timestep</strong>: Increased resolution needs a reduction in timestep. If ‘period’ is kept = 1 day, you need to increase number of timesteps per ‘period’. Check STASH diagnostic requests and frequency of radiation calls are still integer multiples of the timestep.</p></li>
<li><p>Increased resolution requires more memory – you may need to increase ‘number of segments’ for long/short-wave radiation and convection. Or, increase number of processors.</p></li>
<li><p><strong>UM -&gt; env -&gt; Runtime Controls -&gt; Atmosphere Only</strong>: Choose number of processors in North-South and East-West directions. Try to aim for a ‘squarer’ decomposition. If running on more than one node, ensure there are no unused processors (unless allocated to I/O server or coupled model).</p></li>
<li><p>To reconfigure ancillaries : <strong>UM -&gt; namelist -&gt; Reconfiguration and Ancillary control -&gt; Configure ancils and initialise dump fields</strong> : The reconfiguration program can interpolate dumps to other resolutions, but ancillary files can only be used at their native resolution. The UM will fail if you try to “Update” ancillary fields from files at the wrong resolution. Reconfiguration will fail if you try to “Configure” from ancillary files at the wrong resolution.</p></li>
<li><p>In addition to changing processors, you may need to alter job resources (memory and time). Memory is proportional to grid points (unless you have more processors), time is proportional to grid points and timesteps required. These are set in suite files rather than apps.</p></li>
<li><p>Changes to dynamics or diffusion parameters will be required when changing horizontal resolution.</p></li>
</ul>
</li>
<li><p>Changing vertical resolution:</p>
<ul>
<li><p><strong>UM -&gt; namelist -&gt; Reconfiguration and Ancillary control -&gt; Output dump grid sizes and levels</strong> : Choose number of levels, ‘wet’ levels (which include moisture calculations) and ozone levels. <code class="docutils literal notranslate"><span class="pre">ETA_THETA</span></code>, <code class="docutils literal notranslate"><span class="pre">ETA_RHO</span></code> levels and the top height of the model (<code class="docutils literal notranslate"><span class="pre">Z_TOP_OF_MODEL</span></code>) are specified in the vertical levels namelist. The ‘number of levels+1’ <code class="docutils literal notranslate"><span class="pre">ETA_THETA</span></code> values must start at 0.0 and end at 1.0. <code class="docutils literal notranslate"><span class="pre">FIRST</span> <span class="pre">CONSTANT</span> <span class="pre">R</span> <span class="pre">RHO</span> <span class="pre">LEVEL</span></code> is where terrain-following surfaces change to constant height. This should be at least 2x maximum orography height in the model domain. The vertical levels namelist file is <code class="docutils literal notranslate"><span class="pre">vert_lev</span></code> which contains number of boundary layer levels (which may now cover the whole depth of the troposphere to allow better boundary layer/convection coupling), deep soil levels (usually four), and cloud levels used in radiation (which should be the minimum of number of wet levels and total number of levels).</p></li>
<li><p>Cloud info : <strong>UM -&gt; namelist -&gt; UM Science Settings -&gt; General Physics Options -&gt; Large Scale Cloud</strong> : Number of <code class="docutils literal notranslate"><span class="pre">rhcrit</span></code> values must = number of model levels. Regional models often use different sets of low level critical humidity ratio values compared with global models. Diffusion settings may need to be reviewed as they contain level information.</p></li>
<li><p><strong>Ancillaries : UM -&gt; namelist -&gt; Reconfiguration and Ancillary control -&gt; Configure ancils and initialise dump fields</strong>: Changes to vertical levels and spacing will impact the ozone ancillary.</p></li>
<li><p>STASH will need to be updated for new vertical levels (including boundary layer levels), and maybe timestep changes via: <strong>UM -&gt; namelist -&gt; Model Input and Output -&gt; STASH request and profiles</strong>. Avoid the use of timesteps in preference to hours, days etc.</p></li>
</ul>
</li>
<li><p>UM can support up to 150 ‘tracers’ advected using semi-Lagrangian advection scheme. See <strong>UM -&gt; namelist -&gt; Sections 10 11 12 Dynamic settings -&gt; Advection</strong> :</p>
<ul>
<li><p>Tracers are initialised  with ITEMS namelist. Ancillary file for tracer initialisation can be generated from <code class="docutils literal notranslate"><span class="pre">pp</span></code> files, ensure STASH, <code class="docutils literal notranslate"><span class="pre">pp</span></code> and grid codes are correct and set <code class="docutils literal notranslate"><span class="pre">space</span> <span class="pre">code</span> <span class="pre">=</span> <span class="pre">2</span></code> so item is included in the dump.</p></li>
<li><p>The reconfiguration step checks verification time of the data matches that of the dump being reconfigured into. It is difficult to include a ‘test blob’ without recreating the ancillary field. An FCM changeset can get generated to solve this.</p></li>
<li><p>Level dependent constants must match the dump.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">MURK</span></code> is advected using the tracer scheme and can assimilate visibility data. See <strong>UM -&gt; namelist -&gt; UM Science settings -&gt; Section 17 Aerosol (CLASSIC, dust and murk)</strong></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CLASSIC</span></code>, dust and <code class="docutils literal notranslate"><span class="pre">MURK</span></code> lateral boundary conditions (LBCs) can in included in the LBC files.</p></li>
<li><p>UKCA model tracers may be selected depending on chemical or aerosol scheme.</p></li>
<li><p>Free tracers is for testing new schemes. See <strong>UM -&gt; namelist -&gt; UM Science settings -&gt; Section 33 Free Tracers</strong>.</p></li>
</ul>
</section>
<section id="setting-up-a-new-limited-area-model-lam">
<h2>Setting up a new Limited Area Model (LAM)<a class="headerlink" href="#setting-up-a-new-limited-area-model-lam" title="Permalink to this heading">#</a></h2>
<p>Setting up the Unified Model for a new limited area domain is relatively straightforward, and will enable you to run higher resolution suites concentrating on your area of interest. However you should at the outset consider the time and effort involved.</p>
<ul class="simple">
<li><p>The time will be 2 days to a week or so of dedicated work, to get a smoothly running Limited Area Model (LAM) on a new domain, depending on experience. A similar length of time may be needed to create new ancillary files for the new domain. In addition, because of the work involved in preparing Incremental-Analysis-Update/acobs files, running with data assimilation on a new domain requires further work. (Not required for us at 21st Century Weather!).</p></li>
<li><p>It is recommended, where possible, that users base their LAMs on one of the Met Office app configurations. This will greatly reduce the work involved in setting up a LAM over your domain of interest, leaving you to consider:</p>
<ul>
<li><p>the size of domain, horizontal and vertical resolution</p></li>
<li><p>the availability of initial data and boundary conditions</p></li>
<li><p>the length of forecast</p></li>
<li><p>whether ancillary files are available or will need to be created</p></li>
<li><p>what STASH diagnostic output you will require</p></li>
<li><p>what computer resources you have available.</p></li>
</ul>
</li>
<li><p>If the user chooses to build a LAM from scratch, or with different settings (resolution, dynamics and/or physics) to those used by the Met Office one will also need to consider:</p>
<ul>
<li><p>horizontal and vertical resolution (the spacing of grid points/model levels)</p></li>
<li><p>the model timestep</p></li>
<li><p>the choice of science parametrizations</p></li>
<li><p>the order and coefficients of diffusion; these will depend on grid length and timestep.</p></li>
</ul>
</li>
</ul>
<section id="setting-up-a-new-lam-domain">
<h3>Setting up a new LAM domain<a class="headerlink" href="#setting-up-a-new-lam-domain" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>The definition of a UM domains request 8 items:</p>
<ul>
<li><p>Lat/lon co-ords of the rotated pole</p></li>
<li><p>X and Y direction gridlengths – labelled as col and row spacing</p></li>
<li><p>X and Y grid dimensions in gridlengths – labelled as No. Cols/rows</p></li>
<li><p>Lat/lon of bottom left corner (relative to rotated pole), labelled as First lat/lon</p></li>
</ul>
</li>
<li><p>Working in the Southern Hemisphere, take extra care in defining the domain coords. The UM can work with imaginary latitude &gt; 90N for the rotated poll but data in the output files could break plotting programs.</p></li>
<li><p>An alternative and the recommended approach, which gives an identical forecast and a correct map background, is to ”mirror” back to a rotated latitude between 0 and 90N by subtracting from 180, e.g. 110N =&gt; 70N. Then swing the rotated longitude through 180 degrees, and also add 180 degrees to the longitude of the bottom left corner.</p></li>
<li><p>When selecting the new domain, it will save time on tuning the model if you choose a tried and tested resolution for which diffusion coefficients etc. are known. e.g. 0.11 degrees for the current UK NAE model, 0.036 degrees for the UK 4km model, and 0.0189 for AUS2200.</p></li>
</ul>
</section>
<section id="creating-new-ancillary-files">
<h3>Creating new ancillary files<a class="headerlink" href="#creating-new-ancillary-files" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>You will want new land/sea masks, orography, soil, vegetation and ozone ancillary files for your new LAM domain.</p></li>
<li><p>Atmosphere ancilary files are created with a program running on UKMO IBM. If you require one outside UKMO, contact Ported UM support at UKMO.</p></li>
<li><p>Examine the land/sea masks around single grid point islands or sea inlets which may create unrealistic effects for surface and boundary fields. After finalising the land/sea mask, create the other anciliaries.</p></li>
<li><p>Enter values to exactly the same precision as you will use in the UM namelists/GUI when setting up suites. Otherwise your runs may fail internal consistency checks in the model.</p></li>
<li><p>Also make sure longitudes are in the range 0 - 360 degrees as this is preferred for the UM namelists.</p></li>
</ul>
</section>
<section id="obtaining-new-lateral-boundary-data">
<h3>Obtaining new lateral boundary data<a class="headerlink" href="#obtaining-new-lateral-boundary-data" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Use CreateBC to create LBCs.</p></li>
<li><p>Setting up RCF (Reconfiguration) and UM. You can use RCF to transplant data from any new ancilary files into the LAM start dump.</p></li>
<li><p>The orography at edge of the LAM must be the same as used in the driving model. LBC data is defined on the driving model’s levels, which need to be the same heights as the LAM levels in the rimwidth where they are defined. Since model level height depends on the height of the orography beneath it, both models must have the same orography within the LBC rimwidth. In the model area immediately inside the LBC rimwidth the orography is slowly relaxed from the driving model to the full resolution orography for the LAM using linear interpolation. This area is called the `blending zone’ and it includes the LBC rimwidth. Blending across the rimwidth is achieved by running RCF with the input dump from the drivin gmodel to create an output dump for the LAM model to be run. Gridpoints in the blending zone have weights from 1 (orography = driving model) to 0 (orography = LAM).</p></li>
<li><p>Settings for the width of the blending zone and their weights will depend on the orographic details at the LAM boundary. Rimwidth blending weights should be 1.</p></li>
<li><p>Whenever orography in the driving model changes, the blended LAM orogaphy must be reconfigured!</p></li>
<li><p>To check the model domain is set to LAM use UM -&gt; namelist -&gt; Top Level Model Control -&gt; Model Domain and Timestep:</p></li>
<li><p>Use UM -&gt; namelist -&gt; Top Level Model Control -&gt; LAM Configuration to set delta_lat/lon, frstlata/firstlona, polelata, polelona as set in LAMPOS.</p></li>
<li><p>Specify blending zone and LBC file using UM -&gt; namelist -&gt; Top Level Model Control -&gt; LBC Related Options.</p></li>
<li><p>Set forecast run start-time and forecast length using UM -&gt; namelist -&gt; Top Level Model Control -&gt; Run control and Time Settings. Do not exceed the timespan covered by your LBCs!</p></li>
<li><p>Enter your vertical level definitions which must be identical to the file specificed for generatig your LBCs using UM -&gt; namelist -&gt; Reconfiguration and Ancillary Control -&gt; Output dump grid sizes and levels.</p></li>
<li><p>If your land/sea mask was not initialised from an ancillary file you will need to enter the number of land points. You can find this number using RCF.</p></li>
<li><p>You can configure new ancillaries using UM -&gt; namelist -&gt; Reconfiguration and Ancillary Control -&gt;configure ancils and initialise data</p></li>
<li><p>Many suites will be set up (via env var) to immediately pick up the start dump created by reconfiguration. Set this explicitly using UM -&gt; namelist -&gt; Model Input and Output -&gt; Filenames for model input and output.</p></li>
<li><p>If you have a non-standard horizontal resolution, you can revise your choice of diffusion coefficients using UM -&gt; namelist -&gt; UM Science settings -&gt; Section 13: Diffusion, Filtering</p></li>
<li><p>Once set up, execute a run short enough to test STASH output or ancillary updates.</p></li>
<li><p>The UM supports multiple scientific model configurations. Within each sub-model (e.g. atmosphere) there are internal model (e.g. radiation) can be further sub-divided in the sections sub-menu which control routines for calculating diagnostics, I/O operations etc.</p></li>
<li><p>Science schemes should be readily interchangeable with those from other models. The glue routine separates control and science layers.</p></li>
<li><p>IAU = Incremental Analysis Update are computed by VAR and then added to UM initial conditions.</p></li>
<li><p>An ancillary file can contain an ancillary field (temporal boundary conditions for a model forecast ) or a prognostic field (predicted by the model’s output).</p></li>
<li><p>There are 3 ways to include an ancillary file in a UM run:
○ In the initial dump already.
○ Replaced in the initial dump by configuring from an ancillary file on the correct domain and resolution
○ Added to the initial dump as a new ancillary file  y configuring from an ancillary file on the correct domain and resolution</p></li>
<li><p>There are advantages to using ancillary files. The user has more control of the data, the interpolation / regridding performed within the ancillary creation program is consistent across fields (e.g. vegetation and soil parameters).</p></li>
<li><p>For testing new suites, RCF is sufficient and ancillary files only become necessary when the new domain is finalised.</p></li>
<li><p>Locations of ancillary files are specified in ‘Ancil version files’.</p></li>
<li><p>Standard ancillary filenames included ‘parm’ for constant files (e.g. orography, land-sea mask) or ‘clim’ for climatologies which have time-dependence (e.g. soil moisture, SSTs).</p></li>
<li><p>New atmospheric ancillary files can be created using UKMO programs (Central Ancillary File Makng Program)</p></li>
<li><p>Ancillary fields can be ‘configured’ (replaced or added to start dump by RCF) or ‘updated’ (modified at specific time intervals). Updating is part of the UM itself.</p></li>
<li><p>Control of ancillary fields in the UM is done via the rose-app.conf file. Look for namelists &amp;ANCILCTA and optionally &amp;ITEMS if fields are to be updated. The ancillary fie header will determine the update frequency.</p></li>
<li><p>Other controls including SST and sea-ice, temporal interpolation of fields, choice of updating land or sea points are coded in subroutine REPLANCA (one in RCF, one in UM).</p></li>
<li><p>LBCs (created by CreateBC) can be termed as an ancillary file.</p></li>
<li><p>New prognostic and ancillary fields can be set up using any STASH item number.</p></li>
<li><p>Setting up user ancillaries is more restrictive and must use a list of reserved STASH item numbers for single and multi-level fields.</p></li>
<li><p>The UM can be run as a single-column-model for physics testing</p></li>
<li><p>UKMO support coupling with NEMO ocean and CICE sea ice.</p></li>
<li><p>CICE is not dynamically allocated and CPU arrangements must be provided during compilation. This is done by supplying dimensions and PE configuration details in the form of numeric FPP keys which are incorporated in the code during compilation.</p></li>
<li><p>Before you can run a coupled model, you need
○ Directories containing input files
○ NEMO and CICE restart files - usually netCDF files containing the grid definition.
○ NEMO and CICE configuration and FCM options. See Rose configuration items : fcm_make_ocean -&gt; env -&gt; Sources
○ FPP Keys to set all necessary options (including CICE PE config) also need to be set. See fcm_make_ocean -&gt; env -&gt; Pre-processing
○ NEMO and CICE components are built into a single executable combining both sets of code with an internal direct coupling interface. Hence the OASIS3-MCT coupler plays no part in this internal coupling.</p></li>
<li><p>NEMO and CICE have poor error handling (e.g. some NEMO versions terminate with Fortran ‘STOP’, leaving any processes belonging to other components deadlocked). The model will exceed CPU wall time, while the real reason for failure is an internal NEMO-CICE internal error.</p></li>
<li><p>Attempt to ensure all components employ an MPI_ABORT (with non-zero return code to allow rose environment to detect the error) on all processes (possibly via OASIS_ABORT) if it becomes necessary for any of them to prematurely halt execution.</p></li>
<li><p>CICE standard output ice_diag.d is not included in UM output.</p></li>
<li><p>For any failed coupled model run, examine not only the UM outputs but any files created in the job directory produced by the coupler, NEMO or CICE (and there are many!)</p></li>
<li><p>UM uses OASIS3-MCT to support multi-way coupling b/w the UM, NEMO-CICE and a wave model (Wavewatch III). Coupler libraries have to be pre-built. The coupler interfaces routines (PRISM System Model Interface Library - PSMILe) are linked during compilation to the UM and other components.</p></li>
<li><p>To achieve coupling - model states are regridded and passed periodically from one sub-model to another via the coupler.</p></li>
<li><p>The convention is time-averaged atmospheric fields force the ocean, while instantaneous ocean-seaice componetns force the atmosphere (due to the timesteps of the atmosphere being shorter). One or three-hour coupling periods are common practise.</p></li>
<li><p>OASIS3-MCT will handle the regridding between the sub-models.</p></li>
<li><p>For high-resolution configurations the use of ESMF regirdding weights generation tool is recommended.</p></li>
<li><p>Coupled models require less ancillary fields (e.g. no more SST climatologies)</p></li>
<li><p>To do : 5.12.5</p></li>
</ul>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="code.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Code management and structure</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reconfiguration">Reconfiguration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-a-new-limited-area-model-lam">Setting up a new Limited Area Model (LAM)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-a-new-lam-domain">Setting up a new LAM domain</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-new-ancillary-files">Creating new ancillary files</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#obtaining-new-lateral-boundary-data">Obtaining new lateral boundary data</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By 21st Century Weather
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>